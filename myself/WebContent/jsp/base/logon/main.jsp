<%@ page language="java" contentType="text/html; charset=UTF-8"%><%@ include file="/jsp/base/core/taglibs.jsp"%><html>	<head>		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">		<link href="${ctx }/style/main/css/main.css" rel="stylesheet" type="text/css">		<script type="text/javascript" src="${ctx}/style/main/js/progressbar/jquery.progressbar.min.js"></script>		<script type="text/javascript">			var layout = null;			var tab = null;			var accordion = null;			var tree = null;						$(function() {				//检查下载列表中未完成进度				checkDownStatus();				//布局				layout=$("#layout1").ligerLayout({					leftWidth : 190,					height : '100%',					heightDiff : -34,					space : 4,					onHeightChanged : f_heightChanged				});							var height = $(".l-layout-center").height();							//Tab				$("#framecenter").ligerTab({					height : height,					showSwitchInTab : true,                    showSwitch: true				});							//面板				$("#accordion1").ligerAccordion({					height : height - 24,					speed : null				});								//设置当鼠标移动到菜单上时和鼠标移出菜单时 菜单的样式				$(".l-link").hover(function() {					$(this).addClass("l-link-over");				}, function() {					$(this).removeClass("l-link-over");				});								//树				$("#tree1").ligerTree({				    url : '${ctx}/LogonAction.action?method=queryLeftMenu',				    checkbox : false,				    slide: false,				    idFieldName : 'ID',				    parentIDFieldName : 'PID',				    textFieldName : 'TEXT',				    iconFieldName : 'ICON',				    attribute: ['nodename', 'URL'],				    onSelect: function (node){				        if (!node.data.URL || node.data.URL=='/') return;				        var tabid = $(node.target).attr("tabid");				        if (!tabid){				            tabid = new Date().getTime();				            $(node.target).attr("tabid", tabid);				        }				        f_addTab(tabid, node.data.TEXT, '${ctx }'+node.data.URL,node.data.MENU_DESC);				        //layout.setLeftCollapse(true);				    }				});				 				tab = $("#framecenter").ligerGetTabManager();				accordion = $("#accordion1").ligerGetAccordionManager();				tree = $("#tree1").ligerGetTreeManager();				$("#pageloading").hide();							});			//调整tab在高度			function f_heightChanged(options) {				if (tab)					tab.addHeight(options.diff);				if (accordion && options.middleHeight - 24 > 0)					accordion.setHeight(options.middleHeight - 24);			}			var obj = new Object();			//新增一个tab窗口			function f_addTab(tabid, text, url,desc) {				delete obj[tabid]; 				obj[tabid]=desc;				tab.addTabItem({					tabid : tabid,					text : text,					url : url				});			}			//退出系统			function exit(){				window.location.href="${ctx }/LogonAction.action?method=exit";			}			//返回功能的中文描述			function getMenuDesc(){				var desc = obj[tab.getSelectedTabItemID()];				if(desc == undefined || desc == '') desc="该功能无说明";				return desc;			}			//显示下载列表			function downList(){				$("#downList").toggle(200);			}			var timeOut;			//检查下载状态			function checkDownStatus(){				var ids = "";				var fals = true;				var num = 0;				if($(".progress").size()!=0){//加载下载列表					$(".progress").each(function(){						var status = $(this).attr("status");						if(status != '1' && status != '-1'){							var progress = $(this).attr("progress");							if(progress!='100'){								if(ids != "") ids+=",";								ids+= "'"+$(this).attr("id")+"'";								num++;							}						}					});					if(ids == "") fals = false;					//设置当前正在下载的任务数					$("#waitDown").text(num);				}								if(fals){					queryProgress(ids);					timeOut=setTimeout("checkDownStatus()", 3000);				}							}						var wait="等待";			var error="下载失败";			//修改下载进度			//如果ids 为空 查询列表，修改进度			//如果ids 不为空  修改进度			function queryProgress(ids){				$.post("${ctx}/LogonAction.action?method=queryDownFileList", {					ids : ids				}, function(info) {					if (info.info == undefined) {						info = eval("(" + info + ")");					}					if (info.info == 'ok') {						if(ids == '')$("#downFileTable").html(info.downTr);						var str = info.downProgress;						if(str != ""){							var idAndProgress = str.split(",");							for(var i=0;i<idAndProgress.length;i++){								var idPro = idAndProgress[i].split("!");								$("#"+idPro[0]).progressBar(idPro[1]);								$("#"+idPro[0]).attr("progress",idPro[1]);								$("#"+idPro[0]).attr("status",idPro[2]);								if(idPro[3] != ""){									if(idPro[2]=="1"){										$("#down"+idPro[0]).html("<a href='#' onclick=\"downFile('"+idPro[0]+"','"+idPro[3]+"','yes')\"><font color='red'>重复下载</font></a>");									}else if(idPro[2]=="-1"){										$("#down"+idPro[0]).html(error);									}else{										if(idPro[1]=="100"){											$("#down"+idPro[0]).html("<a href='#' onclick=\"downFile('"+idPro[0]+"','"+idPro[3]+"','')\"><font color='red'>下载</font></a>");										}else{											$("#down"+idPro[0]).html(wait);										}									}								}															}						}else{							clearTimeout(timeOut);						}					} else {						$.ligerDialog.error('加载下载列表失败！');					}				});							}						function downFile(downId,filePath,downAgain){				$("#downId").val(downId);				$("#filePath").val(filePath);				$("#downAgain").val(downAgain);				$("#downFileForm").submit();			}			function showPersonalFile(){				$.ligerDialog.open({ title:'个人档案',height: 700,width: 800, url: '${ctx}/PersonalFileAction.action?method=mainShowPersonalFile' });			}		</script>	</head>	<body style="padding:0px;background:#EAEEF5;">		<div id="pageloading"></div>		<div id="topmenu" class="l-topmenu">	    	<div class="l-topmenu-logo">开发平台</div>	    	<div class="l-topmenu-welcome">	    		<font color="white">欢迎【</font>	    		<a href="#" onclick="showPersonalFile()"><font color="red">${userDesc }</font></a>	    		<font color="white">】登录系统</font>	    		<a href="#" onclick="downList()" class="l-link2">下载 <font color="red"><span id="waitDown">0</span></font></a>	        	<a href="#" onclick="exit()" class="l-link2">退出</a> 	    	</div>		</div>		<div id="layout1" style="width:99.2%; margin:0 auto; margin-top:4px; "> 	    	<div position="left"  title="主要菜单" id="accordion1">	        	<div title="功能列表" class="l-scroll">	            	<ul id="tree1" style="margin-top:3px;">	            </div>	     	</div>	     	<div position="center" id="framecenter">	     		<div tabid="home" title="我的主页" style="height:300px" >                	<iframe frameborder="0" src="${ctx }/LogonAction.action?method=welcome"></iframe>            	</div> 	     	</div> 	 	</div>	    <div style="height:32px; line-height:32px; text-align:center;">			2014-01-03 张彦辉 zyhinfo@163.com	    </div>	    	    <div id="downList" style="width:400px;z-index: 100;position:absolute;min-height:200px;	    	display: none;top:25px;right: 60px;background-color: #fff;border:1px solid black;">	    	<table class="self-table" id="downFileTable"></table>        </div>	    <form action="${ctx}/DownLogAction.action?method=getDownFile" method="post" id="downFileForm">    		<input type="hidden" value="" id="downId" name="downId">    		<input type="hidden" value="" id="filePath" name="filePath">    		<input type="hidden" value="" id="downAgain" name="downAgain">    	</form>	</body>	</html>