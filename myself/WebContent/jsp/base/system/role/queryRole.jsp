<%@ page language="java" contentType="text/html; charset=UTF-8"%><%@ include file="/jsp/base/core/taglibs.jsp"%><html>	<head>		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">		<script type="text/javascript">			var grid,quer;				        //表格	        $(function (){	        	init_page();	        	var pageSize = '${pageSize}';	            grid = $("#maingrid").ligerGrid({	                height:'99%',enabledSort:false,	                columns: [	                	{ display: '角色编号', name: 'ROLE_ID', align: 'left', width: 150  },	                	{ display: '角色名称', name: 'ROLE_NAME', align: 'left', width: 250 },	                	{ display: '角色描述', name: 'ROLE_DESC', align: 'left', width: 250 },	                	{ display: '操作', isSort: false, width: 100, render: function (rowdata, rowindex, value){                    		return "<a href='#' onclick=\"updateMenu('"+rowdata.ROLE_ID+"')\">菜单维护</a>";                		}                		}	                ], 	                url:"${ctx}/RoleAction.action?method=getRoleJSON",  	                pageSize:pageSize ,rownumbers:true,	                toolbar: { items: [	                	{ id:'1', text: '查询', click: itemclick, icon: 'search2' },	                	{ line: true },	                	{ id:'2', text: '增加', click: itemclick, icon: 'add' },	                	{ line: true },	                	{ id:'3', text: '修改', click: itemclick, icon: 'modify' },	                	{ line: true },	                	{ id:'4', text: '删除', click: itemclick, icon: 'delete' },	                	{ line: true },	                	{ id:'5', text: '功能说明', click: itemclick, icon: '' }	                ]}	            });	            	            $("#pageloading").hide();	        });	        			function itemclick(item){				var id = item.id;	            var text = item.text;	            if(id == '1'){		        	query=ligerDialog_open(text,$("#targetQuery"),"queryOK","","");	            }else if(id == '2'){	            	liger.get("roleName").setValue("");	            	liger.get("roleDesc").setValue("");	            	ligerDialog_open(text,$("#target"),"addOK","","");	            }else if(id == '3'){	            	var row = grid.getSelectedRow();            		if (!row) { warn_alert('请选择行'); return; }            		$("#roleId").val(row.ROLE_ID);            		liger.get("roleName").setValue(row.ROLE_NAME);            		liger.get("roleDesc").setValue(row.ROLE_DESC);            		ligerDialog_open(text,$("#target"),"editOK","","");	            }else if(id == '4'){	            	var row = grid.getSelectedRow();            		if (!row) { warn_alert('请选择行'); return; }            		$.ligerDialog.confirm('是否删除角色？', function (isOk) {            			if(isOk){		            		$.post("${ctx}/RoleAction.action?method=deleteRole&anticache="									+ Math.floor(Math.random() * 10000), {								id : row.ROLE_ID							}, function(info) {								if (info.info == undefined) {									info = eval("(" + info + ")");								}								if (info.info == 'ok') {									grid.reload();								} else {									error_alert("${ctx}","删除角色失败","编号："+row.ROLE_ID);								}							});						}            		});	            }else if(id == '5'){	            	showMenuDesc(text);	            }	        }	       //查询点击确定按钮			function queryOK(item, dialog){				var gridManager = $("#maingrid").ligerGetGridManager();        		if (!gridManager) return;   				gridManager.setOptions({parms:[{name : "roleName",   					value:liger.get("queryRoleName").getValue()}]});   				gridManager.loadData(true);   				dialog.hidden();			}			//新增点击确定按钮			function addOK(item, dialog){				var param = {					roleName : liger.get("roleName").getValue(),					roleDesc : liger.get("roleDesc").getValue()				};				$.post("${ctx }/RoleAction.action?method=saveRoleAdd&anticache="						+ Math.floor(Math.random() * 10000), param, function(info) {					if (info.info == undefined) {						info = eval("(" + info + ")");					}					if (info.info == 'ok') {	            		grid.reload();	            		dialog.hidden();					} else {						error_alert("${ctx}","新增角色失败",mapToString(param));					}				});			}			//编辑点击确定按钮			function editOK(item, dialog){				var param = {					roleId : $("#roleId").val(),					roleName : liger.get("roleName").getValue(),					roleDesc : liger.get("roleDesc").getValue()				};				$.post("${ctx }/RoleAction.action?method=saveRoleEdit&anticache="						+ Math.floor(Math.random() * 10000), param, function(info) {					if (info.info == undefined) {						info = eval("(" + info + ")");					}					if (info.info == 'ok') {	            		grid.reload();	            		dialog.hidden();					} else {						error_alert("${ctx}","修改角色失败",mapToString(param));					}				});							}			/**			菜单树			**/			var roleAndMenuTree=null;			function updateMenu(roleId){				$("#treeMenu").ligerTree({ 	            	url: 'RoleAction.action?method=querySysMenu&roleId='+roleId,	            	ajaxType: 'post',	            	checkbox : true,				    slide: false,				    idFieldName : 'ID',				    parentIDFieldName : 'PID',				    textFieldName : 'TEXT',				    iconFieldName : 'ICON'	            	});	            $("#roleId").val(roleId);	            roleAndMenuTree = $("#treeMenu").ligerGetTreeManager();				ligerDialog_open("菜单维护",$("#targetMenuTree"),"roleAndMenu","400","500");			}			//菜单维护点击确定按钮			function roleAndMenu(item, dialog){				var ids = "";				var datas = getIncomplete();	            for (var i = 0; i < datas.length; i++){	            	if(ids != "") ids += ",";	                ids += datas[i].ID;	            }				var notes = roleAndMenuTree.getChecked();	            for (var i = 0; i < notes.length; i++){	            	if(ids != "") ids += ",";	                ids += notes[i].data.ID;	            }	            var param = {					roleId : $("#roleId").val(),					ids : ids				};            	$.post("${ctx }/RoleAction.action?method=updateRoleAndMenu&anticache="						+ Math.floor(Math.random() * 10000), param, function(info) {					if (info.info == undefined) {						info = eval("(" + info + ")");					}					if (info.info == 'ok') {						dialog.hidden();					} else {						error_alert("${ctx}","修改角色和菜单关系失败",mapToString(param));					}				});											}						//ligerUI的复选框方法中 没有可以得到 子级选中时本身不完全选中状态的方法			//得到复选框是不完全选中状态的data			function getIncomplete (){	          	var g = roleAndMenuTree, p = roleAndMenuTree.options;	            if (!p.checkbox) return null;	            var datas = [];	            $(".l-checkbox-incomplete", g.tree).parent().parent("li").each(function ()	            {	                var treedataindex = parseInt($(this).attr("treedataindex"));	                datas.push(g._getDataNodeByTreeDataIndex(g.data, treedataindex));	            });	            return datas;	        }		</script>	</head>	<body style="overflow-x:hidden; padding:2px;">		<div class="l-loading" style="display:block" id="pageloading"></div>    	<div id="maingrid"></div>    	<!-- 查询 -->    	<div id="targetQuery" class="self-form" style="display:none;">        	<table class="self-table">    			<tr>    				<td width="90px">角色名称</td>    				<td><input type="text" id="queryRoleName" value=""></td>    			</tr>    		</table>    	</div>    	<!-- 修改新增 -->    	<div id="target" class="self-form" style="display:none;">        	<table class="self-table">    			<tr>    				<td width="90px">角色名称</td>    				<td><input type="text" id="roleName" value=""></td>    			</tr>    			<tr>    				<td width="90px">角色描述</td>    				<td><input type="text" id="roleDesc" value=""></td>    			</tr>    		</table>    	</div>    	<input type="hidden" id="roleId" value=""/>    	<div id="targetMenuTree" style="display:none;">		    <ul id="treeMenu" ></ul>	    </div>	</body></html>