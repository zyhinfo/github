<%@ page language="java" contentType="text/html; charset=UTF-8"%><%@ include file="/jsp/base/core/taglibs.jsp"%><html>	<head>		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">		<script type="text/javascript">			var grid,quer;			var attrs;	        //表格	        $(function (){	        	initAttrs();	            grid = $("#maingrid").ligerGrid({	                height:'99%',rownumbers:false,	                usePager:false,enabledEdit: true,	                columns: [	                	{ display: '列顺序', name: 'COL_1', align: 'left', width: 150,	                		render: function (item){			                	return "第"+item.COL_1+"列";	                		}  	                	},	                	{ display: '样例数据', name: 'COL_2', align: 'left', width: 350 },	                	{ display: '系统字段', name: 'ATTR_NAME', align: 'left', width: 150, 	                		editor: { type: 'select', data: attrs, valueColumnName: 'ATTR_NAME',displayColumnName:'ATTR_DESC' },                    		render: function (item){                    			if(attrs != undefined){	                    			for (var i = 0; i < attrs.length; i++){			                        	if (attrs[i]['ATTR_NAME'] == item.ATTR_NAME){			                            	return attrs[i]['ATTR_DESC'];			                         	}				                 	}			                 	}			                	return item.ATTR_DESC;	                		}	                	}	                ], parms:{filePath:$("#filePath").val()},	                url:"${ctx}/UploadAction.action?method=readFile",	                toolbar: { items: [	                	{id: "1", text: '入库', click: itemclick, icon: '' },	                	{id: "2", text: '返回', click: itemclick, icon: 'back' }	                ]}	            });	            $("#pageloading").hide();	        });	        function initAttrs(){	        	$.ajax({	        		type: "post",	        		async : false,	        		url: "${ctx}/UploadAction.action?method=querySysAttr",	        		dataType: "json",	        		success: function (data) {	        			attrs=data.Rows;	        		},	        		error: function (XMLHttpRequest, textStatus, errorThrown) {	        			alert(errorThrown);	        		}	        	});	        		        }	        			function itemclick(item){				//取消编辑状态				var row = grid.getSelectedRow();            	if (row) {grid.endEdit(row); }				var id = item.id;				if(id == "1"){					var colParam = "";					//if (!row) {return;}					var rowNum = grid.data.Total;					for(var i=0;i<rowNum;i++){						var row=grid.getRow(i);						if(row.ATTR_NAME != undefined && row.ATTR_NAME != ""){							if(colParam != "")colParam+="!";							colParam+=row.COL_1+","+row.ATTR_NAME;						}					}					if(colParam != ""){						var param = {							colParam: colParam,							uploadId: $("#uploadId").val(),							dataName: $("#dataName").val(),							filePath: $("#filePath").val(),							backUrl: $("#backUrl").val(),							endUrl:$("#endUrl").val(),							importTableName:$("#importTableName").val(),							templateTableName:$("#templateTableName").val()						};						$.post("${ctx}/UploadAction.action?method=importDB",param,function(info){							if (info.info == undefined) {								info = eval("(" + info + ")");							}							if (info.info == 'ok') {								success_alert("操作成功");								if('${endUrl}' != undefined){									window.location.href="${ctx}${endUrl}";								}else{									window.location.href="${ctx}/UploadAction.action?method=gotoUpload";								}							} else {								error_alert("${ctx}","数据入库失败",mapToString(param));							}						});					}else{						warn_alert("请设置系统字段");					}				}else if(id=="2"){					$("#paramForm").attr("action","${ctx}/UploadAction.action?method=gotoUpload");					$("#paramForm").submit();				}							}					</script>	</head>	<body style="overflow-x:hidden; padding:2px;">		<input type="hidden" id="dataName" value="${dataName }">		<input type="hidden" id="filePath" value="${filePath }">		<input type="hidden" id="uploadId" value="${uploadId }">		<!-- 公共参数 -->		<form id="paramForm" action="" method="post">			<input type="hidden" id="backUrl" value="${backUrl }">			<input type="hidden" id="endUrl" value="${endUrl }">			<input type="hidden" id="templateTableName" value="${templateTableName }">			<input type="hidden" id="importTableName" value="${importTableName }">		</form>		<div class="l-loading" style="display:block" id="pageloading"></div>    	<div id="maingrid"></div>	</body></html>